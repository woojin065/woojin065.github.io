---
title: 샤딩과 파티셔닝의 차이 및 적용
date: 2025-02-16 00:12:00 +09:00
categories: [common_topic]
tags: [common]
image: 
  path: /images/2025/2-16-ShardingAndPartitioning.png
---

## 🛠 파티셔닝 (Partitioning)

### 🧩 파티셔닝이란 무엇인가? 데이터 관리 효율성을 높이는 마법

![image.png](/images/2025/2-16-ShardingAndPartitioning1.png)

- **파티셔닝(Partitioning)**은 **하나의 물리적인 데이터베이스** 안에서 테이블이나 인덱스를 **논리적인 단위**로 분할하는 기술입니다. 마치 거대한 창고를 섹터별로 나누어 물품을 효율적으로 관리하는 것과 같습니다. 파티셔닝의 핵심 목표는 **데이터 관리 효율성**과 **쿼리 성능 향상**입니다.

### 📊 1. 수평 파티셔닝 (Horizontal Partitioning): 로우(Row) 단위 분할

- **수평 파티셔닝(Horizontal Partitioning)**은 테이블의 **로우(Row)**, 즉 행을 기준으로 데이터를 분할하는 방식입니다. 마치 책을 페이지별로 나누는 것처럼, 동일한 스키마를 가진 테이블을 여러 개의 파티션으로 쪼개는 것이죠.
- **정의 및 작동 방식**: 특정 컬럼의 값을 기준으로 데이터를 나누는 것이 일반적입니다. 예를 들어, `주문일자`를 기준으로 월별 파티션을 생성하거나, `사용자 ID` 범위를 기준으로 파티션을 분리할 수 있습니다.
    
    ![image.png](/images/2025/2-16-ShardingAndPartitioning2.png)
    
- **장점**:
    - **쿼리 성능 향상**: 쿼리 수행 시 전체 테이블을 스캔하는 대신, **필요한 파티션만 스캔**하여 I/O 작업을 획기적으로 줄일 수 있습니다. 특히 특정 파티션에 데이터 접근이 집중되는 경우 쿼리 성능 향상 효과가 두드러집니다.
    - **데이터 관리 용이성**: 파티션 단위로 **백업, 복구, 유지보수** 작업을 수행하여 대용량 테이블의 관리 부담을 크게 줄일 수 있습니다. 예를 들어, 오래된 데이터 파티션은 아카이빙하거나 삭제하여 스토리지 공간을 효율적으로 관리할 수 있습니다.
    - **인덱스 효율 증가**: 각 파티션별로 인덱스가 생성되므로, **인덱스 크기가 감소**하여 인덱스 검색 성능 향상 가능성이 높아집니다.
- **단점**:
    - **데이터 편중 (Data Skew) 문제**: 파티션 키 설계를 잘못하면 특정 파티션에 데이터가 집중되는 **데이터 편중(Data Skew)** 문제가 발생할 수 있습니다. 데이터 편중은 특정 파티션의 부하를 증가시키고, 전체 시스템 성능 저하로 이어질 수 있으므로 파티션 키 설계에 신중해야 합니다.
    - **파티션 간 쿼리 복잡성 증가**: 여러 파티션에 걸쳐 데이터를 조회해야 하는 **크로스 파티션 쿼리(Cross-Partition Query)**는 쿼리 복잡도를 높이고, 성능 저하를 야기할 수 있습니다. 이러한 쿼리 패턴을 고려하여 쿼리 로직 및 성능 최적화 전략을 수립해야 합니다.
- **적용 시나리오**: **시간 기반 데이터**(로그 데이터, 이벤트 데이터)나 **범위 기반 데이터**(지역별 데이터, 등급별 데이터)와 같이 특정 기준으로 데이터 분리가 명확하고, 쿼리 패턴이 예측 가능한 경우에 수평 파티셔닝이 효과적입니다.

### 🗂️ 2. 수직 파티셔닝 (Vertical Partitioning): 컬럼(Column) 단위 분할

- *수직 파티셔닝(Vertical Partitioning)**은 테이블의 **컬럼(Column)**, 즉 열을 기준으로 테이블을 분할하는 방식입니다. 마치 서류를 종류별로 파일 캐비닛에 분리하여 보관하는 것과 유사합니다.
- **정의 및 작동 방식**: 자주 사용하는 컬럼과 덜 사용하는 컬럼을 분리하거나, 보안 민감 정보와 일반 정보를 분리하는 방식으로 테이블을 나눌 수 있습니다.
    
    ![image.png](/images/2025/2-16-ShardingAndPartitioning3.png)
    
    Vertical Partitioning 예시 다이어그램
    
- **장점**:
    - **I/O 효율성 향상**: 자주 사용하는 컬럼만 포함된 파티션에 대한 쿼리를 수행하면, **불필요한 컬럼 I/O를 감소**시켜 쿼리 성능을 향상시킬 수 있습니다. 특히 테이블 컬럼 수가 매우 많은 경우 I/O 효율성 향상 효과가 큽니다.
    - **보안 강화**: **민감 정보와 일반 정보를 분리**하여 보안 정책을 차별적으로 적용하기 용이합니다. 예를 들어, 민감 정보가 담긴 파티션에만 강화된 접근 권한 제어를 적용하여 보안을 강화할 수 있습니다.
    - **테이블 관리 용이성**: 특정 컬럼 그룹에 대한 **관리 효율성**(백업, 복구, 압축 등)을 높일 수 있습니다. 예를 들어, 자주 사용하는 컬럼 그룹만 백업하거나, 용량이 큰 텍스트 컬럼만 압축하여 스토리지 공간을 효율적으로 관리할 수 있습니다.
- **단점**:
    - **조인 연산 증가 및 성능 저하**: 수직 파티셔닝은 테이블을 분리하므로, 분리된 테이블 간에 **조인 연산**이 빈번하게 발생할 수 있습니다. 잦은 조인 연산은 쿼리 성능 저하의 원인이 되므로, 조인 쿼리 성능 최적화에 더욱 신경 써야 합니다.
    - **데이터 중복 가능성**: 파티션 간에 **중복되는 컬럼**이 존재할 수 있습니다. 예를 들어, 조인 연산을 위해 공통 컬럼을 여러 파티션에 포함시키는 경우 데이터 중복이 발생할 수 있으며, 데이터 일관성 관리가 필요합니다.
- **적용 시나리오**: **테이블 컬럼 수가 매우 많고, 특정 컬럼 그룹에 대한 접근 빈도가 높은 경우**에 수직 파티셔닝이 유용합니다. 또한 **보안 요구사항이 높은 민감 정보**를 관리해야 할 때도 효과적인 선택이 될 수 있습니다.

---

## ⚡샤딩 (Sharding)

### 🧱 샤딩이란 무엇인가? 데이터베이스의 수평 확장을 위한 궁극의 전략

- **샤딩(Sharding)**은 데이터를 **여러 개의 독립적인 데이터베이스(Shard)**에 분산 저장하는 기술입니다. 마치 여러 개의 창고를 지어 물품을 분산 보관하여 전체 창고 용량을 늘리는 것과 같습니다. 샤딩의 핵심 목표는 **대용량 데이터 처리**와 **시스템의 수평 확장성 확보**입니다.

### ⚙️ 샤딩의 작동 방식: 데이터 분산, 라우팅, 그리고 샤드 구성

샤딩은 복잡한 기술이지만, 핵심 작동 방식은 다음과 같습니다.

- **샤드 키 (Shard Key) 선정**: 데이터를 어떤 기준으로 샤드에 분산할지 결정하는 **샤드 키(Shard Key) 선정**은 샤딩 전략의 핵심입니다. 샤드 키는 데이터 분산의 균등성, 쿼리 효율성, 그리고 향후 시스템 확장성까지 고려하여 신중하게 결정해야 합니다.
- **샤드 라우팅 (Shard Routing)**: 쿼리가 시스템에 입력되면, **샤드 라우팅(Shard Routing)** 메커니즘을 통해 해당 쿼리를 어느 샤드로 전달해야 할지 결정합니다. 효율적인 라우팅 방식은 전체 시스템 성능에 큰 영향을 미치므로, 라우팅 로직 설계에 심혈을 기울여야 합니다.
- **샤드 구성**: 각 **샤드(Shard)**는 독립적인 데이터베이스 서버로 구성됩니다. 각 샤드는 자체적인 리소스(CPU, Memory, Disk)를 가지고 독립적으로 운영됩니다. 샤드 개수를 늘리는 것만으로 시스템 전체 용량을 선형적으로 확장할 수 있습니다.

### 💡 샤딩의 장점: 무한대로 확장 가능한 시스템, 뛰어난 성능과 안정성

샤딩은 복잡하지만, 강력한 장점을 제공합니다.

- **뛰어난 수평 확장성 (Horizontal Scalability)**: 데이터 증가 또는 트래픽 증가에 따라 **샤드를 추가하는 것만으로 시스템 용량을 선형적으로 확장**할 수 있습니다. 단일 데이터베이스의 성능 한계를 뛰어넘어, 사실상 무한대로 확장 가능한 시스템을 구축할 수 있습니다.
- **높은 가용성 (High Availability)**: 특정 **샤드에 장애가 발생하더라도 다른 샤드는 정상적으로 서비스**를 유지할 수 있습니다. 전체 시스템 장애로 이어지는 위험을 최소화하고, 서비스 가용성을 극대화할 수 있습니다.
- **향상된 성능**: 쿼리가 여러 샤드로 분산되어 **병렬 처리**되므로, 대용량 데이터 처리 성능을 획기적으로 향상시킬 수 있습니다. 특히 읽기 작업 부하가 높은 시스템에서 샤딩 효과가 두드러집니다.

### 🚧 샤딩의 단점: 구축 및 관리 복잡성, 해결해야 할 과제들

샤딩은 강력한 만큼, 극복해야 할 단점과 복잡성도 존재합니다.

- **구축 및 관리 복잡성 증가**: 샤드 구성, 라우팅 로직 구현, 샤드 간 데이터 일관성 관리 등 **시스템 구축 및 관리 난이도가 상승**합니다. 샤딩 시스템 구축 및 운영에는 전문적인 지식과 숙련된 인력이 필요하며, 초기 구축 비용 또한 높을 수 있습니다.
- **샤드 간 쿼리 (Cross-Shard Query) 복잡성**: 여러 샤드에 걸쳐 데이터를 조회해야 하는 **크로스 샤드 쿼리(Cross-Shard Query)**는 쿼리 처리 복잡성을 증가시키고, 성능 저하를 야기할 수 있습니다. 분산 쿼리 처리 기술(Distributed Query Processing)을 적용하여 크로스 샤드 쿼리 성능을 최적화하는 것은 중요한 과제입니다.
- **데이터 재분배 (Rebalancing) 어려움**: 샤드 키를 변경하거나, 샤드를 추가/삭제해야 하는 경우, 데이터 재분배(Rebalancing) 작업이 필요합니다. **데이터 재분배 작업은 시스템 중단을 최소화**하면서 **데이터 무결성을 유지**해야 하므로, 고도의 기술적인 난이도를 요구합니다.

### ⚙️ 샤딩 전략: 데이터를 어떻게 나눌 것인가?

샤딩 전략은 샤딩 시스템의 성능과 효율성을 좌우하는 중요한 요소입니다. 몇 가지 대표적인 샤딩 전략을 살펴보겠습니다.

- **범위 기반 샤딩 (Range-Based Sharding)**: **샤드 키 값의 범위를 기준**으로 데이터를 분산하는 방식입니다. 예를 들어, `사용자 ID` 범위를 나누어 각 샤드에 할당할 수 있습니다.
    - **장점**: 특정 범위의 데이터를 조회하는 **범위 쿼리(Range Query)에 효율적**입니다.
    - **단점**: 데이터가 특정 범위에 편중될 경우 **데이터 편중(Data Skew) 문제**가 발생할 수 있으며, 샤드 범위 재조정이 어려울 수 있습니다.
- **해시 기반 샤딩 (Hash-Based Sharding)**: **샤드 키 값의 해시 함수 결과**를 이용하여 데이터를 분산하는 방식입니다. 예를 들어, `사용자 ID`의 해시 값을 계산하여 특정 샤드를 결정할 수 있습니다.
    - **장점**: 데이터가 샤드에 **균등하게 분산**될 가능성이 높습니다.
    - **단점**: 특정 범위 데이터를 조회하는 **범위 쿼리(Range Query)에 비효율적**이며, 샤드 추가 시 **데이터 재분배 비용이 증가**할 수 있습니다.
- **디렉토리 기반 샤딩 (Directory-Based Sharding)**: **샤드 키와 샤드 위치 정보를 별도의 디렉토리 서비스(Metadata Server)**에 관리하는 방식입니다.
    - **장점**: **유연한 라우팅**이 가능하고, **샤드 재분배가 용이**합니다.
    - **단점**: 디렉토리 서비스에 부하가 집중될 수 있으며, 디렉토리 서비스가 **단일 장애점(Single Point of Failure)**이 될 가능성이 있습니다.

---

### 📊 본론 3: 샤딩 vs 파티셔닝 - 핵심 차이점 비교 분석

| 구분 | 파티셔닝 (Partitioning) | 샤딩 (Sharding) |
| --- | --- | --- |
| **데이터 분산 범위** | 단일 데이터베이스 내부 (논리적 분할) | 여러 데이터베이스 (물리적 분산) |
| **복잡성** | 샤딩에 비해 상대적으로 단순 (구현 및 관리 용이) | 파티셔닝보다 훨씬 복잡 (라우팅, 분산 트랜잭션, 재분배 등 고려사항 多) |
| **확장성** | 주로 단일 DB 성능 향상 (수직 확장 및 제한적 수평 확장) | 시스템의 수평 확장성 극대화 (대규모 데이터, 트래픽 처리) |
| **관리 오버헤드** | 상대적으로 낮음 (기존 DB 관리 도구 및 기술 활용 가능) | 높음 (분산 시스템 관리, 모니터링, 장애 대응 등 전문 운영 관리 필요) |
| **트랜잭션** | 단일 DB 트랜잭션 (ACID 속성 보장 용이) | 분산 트랜잭션 (ACID 속성 보장 복잡, eventual consistency 고려) |
| **주요 사용 목적** | 단일 DB 내 성능 향상 및 관리 효율성 증대 | 대용량 데이터 처리 및 시스템의 수평 확장성 확보 |

위 표에서 샤딩과 파티셔닝의 핵심 차이점을 명확하게 확인할 수 있습니다. 파티셔닝은 **하나의 데이터베이스**를 효율적으로 관리하기 위한 기술이고, 샤딩은 **여러 개의 데이터베이스**로 시스템 전체를 확장하기 위한 기술이라는 것을 기억하시면 됩니다.

---

## 🎯 언제 파티셔닝을, 언제 샤딩을 선택해야 할까?

| 고려사항 | 파티셔닝 (Partitioning) | 샤딩 (Sharding) |
| --- | --- | --- |
| **데이터 규모** | 단일 DB로 감당 가능, 폭발적인 증가 예상되지 않는 경우 | 매우 크고 지속적인 폭증 예상, 수평 확장이 필수적인 경우 |
| **쿼리 패턴** | 대부분 쿼리가 특정 파티션에 집중, 파티션 간 조인 연산 빈도 낮은 경우 | 쿼리가 전체 데이터셋에 고르게 분산, 샤드 간 쿼리 overhead 감수 가능 경우 |
| **확장성 요구사항** | 단일 DB 서버 성능 한계 내 성능 향상 및 관리 효율성 확보 목표 | 시스템 전체 처리 용량 선형 확장, 무중단 서비스 확장 목표 |
| **시스템 복잡성** | 비교적 단순한 시스템 구조 및 관리 선호 | 시스템 구축 및 관리 복잡성 감수 가능, 전문 인력/인프라 확보 가능 |
| **예산 및 인프라** | 상대적으로 적은 비용으로 성능 개선 및 관리 효율성 증대 희망 | 분산 시스템 구축/운영에 필요한 초기 투자 비용 및 지속적인 관리 비용 감당 가능 |
| **성능 목표** | 특정 유형 쿼리 성능 향상 및 전반적인 응답 시간 단축 목표 | 전체 시스템 처리량 증대 및 낮은 지연 시간 유지 목표 |

위 표는 샤딩과 파티셔닝 선택 시 고려해야 할 주요 요소들을 정리한 것입니다.  **데이터 규모, 쿼리 패턴, 확장성 요구사항, 시스템 복잡성, 예산, 성능 목표** 등을 종합적으로 고려하여 프로젝트에 맞는 최적의 데이터 분산 전략을 선택해야 합니다.

---

## 📝 샤딩 및 파티셔닝 구현 시 고려사항

샤딩과 파티셔닝을 실제 시스템에 적용하기 위해서는 몇 가지 중요한 고려사항들을 꼼꼼히 챙겨야 합니다.

- **파티션 키/샤드 키 선정**: 데이터 분산 전략의 핵심은 **파티션 키(Partition Key)** 또는 **샤드 키(Shard Key)** 를 적절하게 선정하는 것입니다. 데이터 편중을 방지하고, 쿼리 효율성을 높이며, 향후 시스템 확장성까지 고려하여 신중하게 키를 선정해야 합니다.
- **데이터 재분배 전략**: 데이터 증가, 샤드/파티션 구성 변경 시 **데이터 재분배(Rebalancing)**는 불가피합니다. 무중단 서비스, 데이터 무결성, 재분배 시간 단축 등을 고려한 효율적인 재분배 전략 수립은 매우 중요합니다.
- **쿼리 라우팅 및 분산 쿼리 처리**: 샤딩 환경에서 쿼리를 적절한 샤드로 **라우팅**하고, 여러 샤드에 걸친 쿼리를 **효율적으로 처리**하는 메커니즘 구현은 샤딩 시스템 성능을 좌우하는 핵심 요소입니다.
- **분산 트랜잭션 관리**: 샤딩 환경에서 **ACID 트랜잭션**을 보장하기 위한 분산 트랜잭션 관리 기술 (2PC, Saga 패턴 등) 적용을 신중하게 고려해야 합니다. 분산 트랜잭션은 성능 저하를 야기할 수 있으므로, eventual consistency 기반의 BASE 모델을 고려하는 것도 좋은 대안이 될 수 있습니다.
- **모니터링 및 운영 관리**: 샤딩/파티셔닝 시스템의 안정적인 운영을 위해서는 **통합 모니터링 시스템 구축** 및 **전문 운영 인력 확보**가 필수적입니다. 분산 시스템 환경에 대한 깊이 있는 이해와 숙련된 운영 경험이 중요합니다.

---