---
title: 데이터 정합성을 유지하는 방법
date: 2025-02-16 00:10:00 +09:00
categories: [common_topic]
tags: [common]
image: 
  path: /images/2025/2-16-DataConformance1.png
---

## 데이터 정합성이란?
![image.png](/images/2025/2-16-DataConformance2.png)
데이터 정합성은 데이터가 **정확하고 일관성 있게 유지**되는 상태를 의미합니다. 데이터베이스는 물론, 모든 IT 시스템에서 데이터 정합성은 **데이터 품질**을 보장하는 **가장 기본적인 토대**입니다. 

### **✅ 왜 데이터 정합성이 중요할까요?**

만약 쇼핑몰에서 상품 재고 정보가 엉망이라면 어떨까요? 고객은 품절된 상품을 주문하고, 기업은 불필요한 고객 불만을 처리해야 합니다. 😥 데이터 분석 결과가 부정확하면 기업은 잘못된 의사 결정을 내릴 수 있습니다. 📉

**데이터 정합성이 깨진다면:**

- **잘못된 의사 결정**: 부정확한 데이터 기반 분석은 기업의 생존을 위협하는 오판으로 이어질 수 있습니다.
- **업무 효율성 저하**: 데이터 오류 수정, 데이터 불일치 문제 해결에 불필요한 시간과 비용이 낭비됩니다. ⏰
- **시스템 신뢰도 하락**: 사용자들은 데이터 오류가 잦은 시스템을 신뢰하지 않게 됩니다. 🙅‍♀️
- **법적 문제 발생**: 개인 정보 오류, 규제 데이터 위반 등은 법적 문제로 이어질 수 있습니다. ⚖️

---

## **🛠️ 본론 1: 데이터 정합성, 어떻게 지킬 수 있을까요?**

데이터 정합성은 설계, 개발, 운영 모든 단계에서 꼼꼼하게 관리해야 합니다. 🧱 튼튼한 건물을 짓기 위한 설계도처럼, 데이터베이스 설계 단계부터 정합성을 고려해야 튼튼한 데이터 시스템을 만들 수 있습니다.

### **1. 꼼꼼한 데이터 모델링 & 설계:**

- **정규화 (Normalization):** 데이터 중복을 최소화하고, 데이터 모델을 효율적으로 설계하는 기본! 뼈대! 뼈와 근육을 튼튼하게 만들어줍니다. 💪 (정규화, 반정규화 내용은 이전 블로그에서 다뤘었죠? 😉)
    - **핵심**: 데이터 중복 최소화, 데이터 삽입/수정/삭제 이상 현상 방지
    - **균형**: 과도한 정규화는 성능 저하를 야기할 수 있으니, 비즈니스 요구사항과 성능을 고려해야 합니다.
- **ER 모델 (Entity-Relationship Model) 활용:** 데이터 구조와 관계를 시각적으로 설계하는 도구! 설계도를 꼼꼼하게 그려 오류를 줄이는 과정입니다. 🗺️
    - **핵심**: 테이블, 컬럼, 관계 명확하게 정의, 데이터 모델 완성도 향상
    - **장점**: 개발자와 설계자, 운영자 모두 데이터 구조를 쉽게 이해하고 소통할 수 있습니다.
- **데이터 타입 & 제약 조건 설계:** 데이터 값의 종류, 범위, 유효성 규칙을 정의! 집을 지을 때 사용하는 벽돌과 시멘트처럼 데이터의 형태와 규칙을 정해줍니다. 🧱
    - **핵심**: 데이터의 유효성 확보, 데이터 오류 방지
    - **예시**: 숫자형 컬럼에는 숫자만, 날짜형 컬럼에는 날짜 형식만 입력하도록 제한

### **2. 무결성 제약 조건 활용 :**

데이터베이스 시스템이 **자동으로** 데이터 정합성을 검증하고 유지하도록 돕는 **강력한 도구**입니다. 마치 건물 안전 점검 시스템처럼, 데이터 오류를 실시간으로 감지하고 예방합니다. 🚨

데이터 무결성 제약 조건은 크게 **4가지**로 나눌 수 있습니다. 각각의 역할과 중요성을 자세히 알아볼까요? 🧐

**(1) 도메인 무결성 (Domain Integrity): 데이터 값의 유효 범위 보장**

- **정의**: 특정 컬럼(속성) 값은 **허용 가능한 데이터 타입, 유효 범위, 형식**을 가져야 합니다. 데이터 값 자체의 **유효성**을 확보하는 가장 기본적인 단계입니다. 데이터 값의 '자격'을 검증하는 것입니다.

```sql
-- PostgreSQL 예시

CREATE TABLE 상품 (
    상품_ID SERIAL PRIMARY KEY, -- 자동 증가 정수형 (고유 식별자)
    상품명 VARCHAR(255) NOT NULL, -- 문자열 (최대 255자), 필수 입력
    가격 INTEGER CHECK (가격 >= 0), -- 정수형, 0 이상 값만 허용 (CHECK 제약 조건 활용)
    등록일 DATE DEFAULT CURRENT_DATE, -- 날짜형, 기본값은 현재 날짜
    할인율 DECIMAL(3,2) CHECK (할인율 BETWEEN 0 AND 1) -- 소수점 (전체 3자리, 소수점 2자리), 0~1 사이 값만 허용
);

-- MySQL 예시

CREATE TABLE 상품 (
    상품_ID INT AUTO_INCREMENT PRIMARY KEY,
    상품명 VARCHAR(255) NOT NULL,
    가격 INT CHECK (가격 >= 0),
    등록일 DATE DEFAULT (CURRENT_DATE()),
    할인율 DECIMAL(3,2) CHECK (할인율 BETWEEN 0 AND 1)
);

-- Oracle 예시

CREATE TABLE 상품 (
    상품_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    상품명 VARCHAR2(255) NOT NULL,
    가격 NUMBER CONSTRAINT 가격_양수_CHECK CHECK (가격 >= 0), -- CONSTRAINT 이름 지정
    등록일 DATE DEFAULT SYSDATE,
    할인율 NUMBER(3,2) CONSTRAINT 할인율_범위_CHECK CHECK (할인율 BETWEEN 0 AND 1)
);
```

**(2) 참조 무결성 (Referential Integrity): 테이블 간의 관계 일관성 유지**

- **정의**: **외래 키 (Foreign Key) 제약 조건**을 통해 테이블 간의 **관계**를 명확히 정의하고, 데이터베이스 내 **고아 레코드 (orphaned record)** 발생을 방지하여 관계 무결성을 유지합니다. 테이블 간의 '약속'을 지키도록 강제하는 것입니다. 🤝
- **핵심**: **관계 있는 테이블의 데이터는 항상 서로 일관성을 유지**해야 합니다. 부모 테이블의 데이터가 변경되면, 자식 테이블의 데이터도 **자동으로** 함께 변경되거나, 변경이 제한되어야 합니다.
- **예시:**
    - `주문` 테이블의 `고객_ID` 컬럼은 `고객` 테이블의 `고객_ID` 컬럼을 **참조**하는 외래 키
    - `고객` 테이블에서 고객 정보가 삭제되면, 해당 고객의 `주문` 정보도 **자동으로 삭제** (CASCADE 옵션) 되거나, 삭제가 **제한** (RESTRICT 옵션) 되어야 합니다.
- **외래 키 제약 조건 옵션:**

| 옵션 | 설명 |
| --- | --- |
| **CASCADE** | 참조되는 테이블의 데이터 삭제/수정 시, 참조하는 테이블의 데이터도 함께 삭제/수정 |
| **RESTRICT** | 참조되는 테이블의 데이터 삭제/수정 시, 참조하는 테이블에 데이터가 존재하면 삭제/수정 작업 거부 (기본 옵션) |
| **SET NULL** | 참조되는 테이블의 데이터 삭제/수정 시, 참조하는 테이블의 외래 키 값을 NULL로 설정 (외래 키 컬럼이 NULL 값을 허용하는 경우에만 사용 가능) |
- **순환 참조 문제**: 테이블들이 서로 참조하는 복잡한 관계 (순환 참조) 는 데이터베이스 설계를 복잡하게 만들고, 무결성 제약 조건 관리를 어렵게 할 수 있습니다. 설계 단계에서 순환 참조를 최소화하거나, 발생 시 적절한 해결 전략 (예: 트리거, 응용 프로그램 로직) 을 수립해야 합니다. 🤯
    
    ![image.png](/images/2025/2-16-DataConformance.png)
    
- **중요성**: **데이터베이스 관계의 일관성**을 유지하고, **고아 레코드** 발생을 방지하여 데이터 신뢰도를 높입니다. 데이터들이 서로 엉키지 않고 질서정연하게 관리되도록 돕습니다. 🗂️

**(3) 개체 무결성 (Entity Integrity): 각 테이블의 레코드 고유성 보장**

- **정의**: 각 테이블은 **기본 키 (Primary Key) 제약 조건**을 통해 **고유하게 식별**되는 레코드 (행)를 가져야 합니다. 기본 키는 **NULL 값을 가질 수 없으며**, 테이블 내에서 **중복될 수 없습니다**. 각 레코드를 '주민등록번호'처럼 고유하게 만드는 것입니다. 🔑
- **핵심**: 테이블의 각 행은 **유일해야** 하며, **반드시 존재**해야 하는 속성 (기본 키)을 가져야 합니다.
- **기본 키 설계 방식:**
    - **복합 키 (Composite Key):** 두 개 이상의 컬럼 조합으로 기본 키 구성. 자연스러운 키를 사용할 수 있지만, 복잡성 증가 가능. 🧩
    - **대리 키 (Surrogate Key):** 인공적으로 생성된 키 (예: 자동 증가 정수 값)를 기본 키로 사용. 단순하고 효율적인 키 관리 가능. 🔢
- **UNIQUE 제약 조건과의 차이점**:
    - **기본 키**: NULL 값 **불허**, 테이블 당 **하나만** 정의 가능
    - **UNIQUE**: NULL 값 **허용**, 테이블 당 **여러 개** 정의 가능
    - **역할**: 기본 키는 **개체 식별**, UNIQUE는 **값의 유일성** 보장 (개체 식별 X)
- **중요성**: **테이블 내 레코드의 유일성**을 보장하고, **NULL 값**으로 인해 레코드를 식별할 수 없는 상황을 방지합니다. 데이터 레코드 하나하나를 정확하게 식별하고 관리할 수 있도록 돕습니다. 🆔

**(4) 비즈니스 규칙 무결성 (Business Rule Integrity):  데이터가 비즈니스 규칙 준수 보장**

- **정의**: 데이터베이스는 데이터 모델링에서 **명시적으로 정의하기 어려운 복잡한 비즈니스 규칙**을 반영해야 할 수 있습니다. 데이터가 '회사 규칙'을 잘 따르는지 검사하는 것입니다. 🏢
- **예시**:
    - `주문 금액`은 항상 `상품 가격` X `주문 수량` 보다 크거나 같아야 함
    - `할인율`은 특정 조건 (VIP 고객, 특정 상품 등) 에 따라 다르게 적용되어야 함
    - 특정 시간 이후에는 주문 취소 불가
- **구현 방법:**
    - **트리거 (Trigger):** 특정 테이블에 데이터 변경 이벤트 (INSERT, UPDATE, DELETE) 발생 시 **자동으로 실행**되는 코드로, 복잡한 비즈니스 규칙을 구현하고 데이터 정합성을 유지하는 데 효과적입니다. 데이터 변경 감시 + 자동 처리 시스템! 👮‍♀️
    - **저장 프로시저 (Stored Procedure):** 데이터베이스에 저장된 SQL 코드로, 데이터 조작 및 비즈니스 로직을 캡슐화하여 일관성을 높이고, 재사용성을 향상시킬 수 있습니다. 업무 처리 매뉴얼! 📜
- **선언적 무결성 제약 조건 (CHECK 제약 조건) 과의 비교:**
    - **선언적 제약 조건**: 단순 규칙 정의에 적합 (예: `나이` > 0)
    - **트리거, 저장 프로시저**: 복잡한 비즈니스 규칙 구현에 더 유연하고 강력한 방법 제공
- **중요성**: **데이터가 비즈니스 규칙에 부합**하도록 강제하고, 데이터의 **업무적인 의미**를 정확하게 반영합니다. 데이터가 '제대로' 사용될 수 있도록 보장합니다. ✅

### **3. 데이터 검증 및 모니터링:**

- **데이터 검증 (Data Validation):** 새로운 데이터가 입력될 때, 미리 정의된 규칙에 따라 데이터의 유효성을 검사하는 과정입니다. 새로운 식재료 검수 과정! 깐깐하게 품질을 확인합니다. 깐깐징어! 🧐
    - **예시**: 응용 프로그램 레벨, 데이터베이스 레벨에서 데이터 유효성 검사
- **데이터 품질 모니터링 (Data Quality Monitoring):** 데이터베이스에 저장된 데이터의 품질을 지속적으로 측정하고 감시하는 과정입니다. 주기적인 건강 검진! 데이터도 꾸준히 관리해야 건강하게 유지할 수 있습니다. 🏥
    - **예시**: 데이터 프로파일링 도구 활용, 정기적인 데이터 품질 보고서 작성
- **감사 로그 (Audit Log) 활용:** 데이터 변경 이력을 기록하고 추적하여 데이터 정합성 문제 발생 시 원인 분석 및 책임 추적에 활용합니다. CCTV 감시 시스템! 데이터 변경 내역을 꼼꼼하게 기록합니다. 📹

## **🛡️ 2. NoSQL 환경에서의 데이터 정합성 도전과 극복**

NoSQL 데이터베이스는 RDB와 달리 **BASE (Basically Available, Soft state, Eventually consistent)** 라는 철학을 따릅니다. (CAP 이론, ACID vs BASE 내용은 추후 블로그에서 더 자세히 다룰 예정입니다! 😉)

- **NoSQL의 특징**: 높은 가용성, 확장성, 유연성을 강조하지만, **데이터 정합성은 RDB보다 완화된 수준** (최종적 일관성) 을 목표로 합니다.
- **NoSQL 환경에서의 데이터 정합성 확보**: 데이터베이스 모델별 특징을 이해하고, 비즈니스 요구사항에 맞는 **일관성 모델**을 선택해야 합니다. (Strong Consistency, Eventual Consistency 등)
- **최근 트렌드**: NoSQL 데이터베이스도 **트랜잭션 지원을 강화**하는 추세입니다. (분산 트랜잭션 관리 기법 활용 - Saga 패턴 등)