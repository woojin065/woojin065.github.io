---
title: 컨테이너 배포 전략 (무중단 배포)
date: 2025-03-16 00:10:00 +09:00
categories: [common_topic]
tags: [common]
# image: 
#   path:
---


## 1. 간략한 소개

서비스가 대규모 트래픽을 처리하거나, 사용자가 24시간 서비스를 이용해야 하는 환경에서는 **배포 중 다운타임**이 발생할 경우 **비즈니스적 손실**이 크기 마련입니다. 이를 방지하기 위해 **무중단(Zero Downtime) 배포 전략**이 각광을 받고 있습니다. 본 글에서는 **컨테이너 환경**에서 적용 가능한 주요 배포 전략들과 특징을 알아보고, 상황에 따른 선택 기준과 구현 사례를 살펴보겠습니다.

---

## 2. 주요 배포 전략 개요

### 2.1 빅뱅 배포 (Big Bang Deployment)

![image](/images/2025/3-16-CD.png)

- **개념**: 기존 버전을 전면 중지하고, 새 버전을 한 번에 교체·배포하는 방식입니다.
- **특징**:
    - **짧은 시간 안에** 전체 시스템이 새로운 버전으로 전환.
    - 단일 타이밍에 모든 변경 사항이 투입되므로, 한 번에 많은 기능이나 수정사항을 출시하기 쉬움.
- **장단점**:
    - **장점**:
        - 구현이 간단하고, 초기 세팅과 개발 프로세스가 비교적 단순.
        - 전체 버전을 한 번에 적용하므로 버전 관리가 쉬움.
    - **단점**:
        - 배포 시 다운타임이 발생하기 쉬움.
        - 롤백 시에도 전면적인 되돌림이 필요하여 위험 부담이 큼.
    - **적합한 상황**:
        - 내부 테스트 서버, 혹은 서비스 규모가 크지 않아 **약간의 다운타임**을 감수할 수 있는 경우.

### 2.2 블루 그린 배포 (Blue-Green Deployment)

![image](/images/2025/3-16-CD1.png)

- **개념**:
    - **‘블루’ 환경**(현재 라이브 서비스)과 **‘그린’ 환경**(새 버전이 준비된 환경)을 **동시에** 운영하고, 배포 시점에 트래픽 라우팅만 바꾸어 전환하는 방식입니다.
- **특징**:
    - 전환(스위칭) 순간을 제외하고는 다운타임이 거의 없음.
    - 빠른 롤백: 문제가 생기면 다시 블루 환경으로 라우팅을 되돌리면 되기 때문.
- **장단점**:
    - **장점**:
        - 무중단 배포와 **즉각적인 롤백**이 가능.
        - 새 버전을 충분히 테스트한 뒤 실환경으로 전환 가능.
    - **단점**:
        - **두 벌의 인프라**(블루/그린)를 동시에 유지해야 하므로 비용이 증가.
        - 환경 동기화(데이터, 설정 파일 등)에 신경 써야 함.
    - **적합한 상황**:
        - **안정성**이 중요한 금융, 이커머스 사이트, 높은 SLA(Service Level Agreement) 요구되는 서비스.

### 2.3 롤링 업데이트 (Rolling Update)

![image](/images/2025/3-16-CD2.png)

- **개념**:
    - 애플리케이션 인스턴스를 **하나씩**(또는 일정 수씩) 순차적으로 새 버전으로 교체하는 방식입니다.
- **특징**:
    - 배포 과정에서 일부 인스턴스만 업데이트되어 구버전과 신버전이 **동시 공존**.
    - 컨테이너 오케스트레이션 도구(Kubernetes 등)를 통해 **자동**으로 진행되기도 함.
- **장단점**:
    - **장점**:
        - 전체 서비스를 내려야 하는 빅뱅 방식에 비해 다운타임이 거의 없음.
        - 점진적 배포를 통해 특정 인스턴스에서 문제 발견 시 빠르게 대응 가능.
    - **단점**:
        - 구버전과 신버전이 동시에 존재하는 기간이 있기 때문에, API 호환성 이슈가 있을 수 있음.
        - 배포 완료까지 걸리는 시간이 다소 길어질 수 있음.
    - **적합한 상황**:
        - 이미 **Kubernetes**나 **Docker Swarm** 같은 오케스트레이션 툴을 사용 중이고, API 호환성 이슈를 잘 관리할 수 있는 환경.

### 2.4 카나리 배포 (Canary Deployment)

![image](/images/2025/3-16-CD3.png)

- **개념**:
    - 전체 사용자 중 극히 일부(예: 1%~5%)에게만 새로운 버전을 먼저 배포하고, **문제 발생 여부**를 모니터링 후 점진적으로 트래픽을 늘려가는 방식입니다.
- **특징**:
    - 실 사용자 트래픽으로 새 버전을 **소규모 검증**할 수 있음.
    - 문제 발생 시 영향 범위가 제한적이라 리스크가 적음.
- **장단점**:
    - **장점**:
        - 초기 테스트 후 문제가 없으면 점차 확대하여 배포 → 장애 발생 위험 최소화.
        - 사용자의 피드백을 기반으로 최적화 가능.
    - **단점**:
        - 트래픽 분산을 위한 **부하 분산(Load Balancer)**나 **특정 라우팅 규칙** 설정이 필요.
        - 데이터베이스나 캐시 사용 시, 구버전/신버전 간 스키마 호환성 관리가 중요.
    - **적합한 상황**:
        - **대규모 사용자**를 가진 환경에서 새로운 기능을 **안전하게** 테스트하고 싶은 경우.
        - 사용자의 실질적인 행동 데이터를 기반으로 신버전 완성도를 높이고 싶은 팀.

---

## 3. 전략 비교 및 선택 기준

| 전략 | 다운타임 | 롤백 용이성 | 인프라 비용 | 배포 복잡도 | 주요 활용 사례 |
| --- | --- | --- | --- | --- | --- |
| **빅뱅** | 있음 | 어려움 | 낮음 | 낮음 | 소규모/내부 서비스 |
| **블루-그린** | 없음(거의) | 매우 쉬움 | 높음 | 중간 | 고가용성 필수 서비스 |
| **롤링 업데이트** | 거의 없음 | 보통 | 보통 | 중간 | Kubernetes + CI/CD |
| **카나리** | 없음(거의) | 쉬움 (초기 단계) | 보통 | 다소 높음 | 대규모 사용자 서비스 |
- **다운타임 허용 범위**: 금융/이커머스처럼 다운타임이 치명적인 경우 블루-그린, 롤링, 카나리 방식이 주로 선호됩니다.
- **인프라 리소스**: 비용이 여유 있는지, 환경을 2개(블루+그린) 이상 유지할 여건이 되는지 고려해야 합니다.
- **배포 복잡도**: API 버전 관리, DB 마이그레이션, 설정 파일 호환성 등 시스템 구조가 복잡해질수록 세심한 배포 전략이 필요합니다.

---

## 4. 실제 구현 사례와 도구

### 4.1 Kubernetes 기반 무중단 배포

- **Deployment & Service**:
    - `Deployment`에서 **롤링 업데이트 전략**(RollingUpdate)을 정의하고, `Service`가 자동으로 트래픽을 새 파드(Pod)로 분산.
    - **카나리** 배포도 `Service`와 레이블(Label) 설정, Ingress 라우팅 등을 활용해 부분 트래픽만 신버전으로 전달 가능.
- **Kubectl 명령어** 예시(롤링 업데이트):

이 명령을 통해 현재 애플리케이션을 점진적으로 v2 이미지를 기반으로 업데이트합니다.
    
    ```bash
    kubectl set image deployment/my-app my-container=myrepo/myapp:v2
    ```
    

### 4.2 AWS ECS/EKS 블루-그린 배포

- **AWS CodeDeploy**:
    - ECS 클러스터 내에서 **블루-그린** 배포를 자동화해 주는 기능 제공.
    - 배포 시 `ApplicationLoadBalancer`를 통해 **기존 버전(블루)** → **새 버전(그린)** 전환을 무중단으로 처리.
- **EKS**(Elastic Kubernetes Service):
    - Kubernetes와 동일한 방식으로 **롤링 업데이트**, **카나리 배포** 가능.
    - 필요 시 ALB Ingress Controller를 통해 **트래픽 제어**, 배포 완료 후 구 버전 파드를 제거.

---

## 5. 결론 및 향후 발전 방향

- **무중단 배포 전략 요약**
    - **빅뱅**: 전면 교체, 구현 간단하지만 다운타임과 롤백 위험이 큼
    - **블루-그린**: 무중단 + 빠른 롤백, 그러나 인프라 비용 상승
    - **롤링 업데이트**: 점진적 교체, 구버전과 신버전 공존으로 호환성 주의
    - **카나리 배포**: 실 사용자 일부에게 새 버전 노출, 위험 최소화
- **미래 전망**:
    - **GitOps**, **Service Mesh** 등과 결합하여 배포 자동화가 더욱 고도화될 전망.
    - **A/B 테스트**, **Feature Toggle** 기법과 함께 사용해 사용자 경험을 실시간으로 개선할 수 있음.
- **실무 적용 시 고려사항**:
    - **CI/CD 파이프라인**과의 긴밀한 연동(빌드-테스트-배포 자동화)
    - **관찰성(Observability)**: 모니터링, 로깅, 알림 체계를 잘 갖춰야 문제 상황을 즉시 파악하고 롤백 가능
    - **데이터베이스 스키마 변화**, **API 호환성** 등 대규모 시스템 변경 시 사전 시뮬레이션 및 점진적 적용 권장

---

## 마무리

컨테이너 시대에 **무중단 배포**는 이미 선택이 아닌 필수입니다. 위에서 살펴본 **빅뱅, 블루-그린, 롤링 업데이트, 카나리** 전략은 각각 장단점과 적용 범위가 다릅니다. 실제 환경에 맞춰 **다운타임 요구사항**, **인프라 규모**, **롤백 시나리오** 등을 종합 고려해 적절한 배포 전략을 선택하시길 바랍니다.

더불어, AWS ECS/EKS, Kubernetes 등 **오케스트레이션 플랫폼**과 **CI/CD 파이프라인**을 잘 연동하면 무중단 배포를 한층 더 자동화하고 효율화할 수 있습니다. 앞으로도 새로운 무중단 배포 기법과 도구가 등장할 것이므로, 꾸준한 학습과 실험을 통해 **안정적인 서비스 운영**에 도전해 보세요!